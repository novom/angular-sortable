/*!
angular-sortable - 0.0.2
Angular.js implementation of sortable as a directive.
Build date: 2014-10-07 
*/
!function(a){"use strict";function b(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function c(b,c){this.options=a.extend({items:".sortable",handles:null,zindex:"9000",dragX:!0,dragY:!0,onChange:null,onDragstart:null,onDrag:null,onDragend:null},c);var d=b.scope().$id;this.classes={};for(var f in e)this.classes[f]=e[f]+"-"+d;this.deltaX=0,this.deltaY=0,this.enabled=null,this.state=null,this.$element=a(b),this.$activeItem=null,this.refresh()}var d={drag:"mousemove touchmove",dragstart:"mousedown touchstart",dragend:"mouseup touchend",selectstart:"selectstart"},e={sorting:"sortable-sorting",item:"sortable-item",handle:"sortable-handle",clone:"sortable-clone",active:"sortable-activeitem"},f=a(document.body),g=2;c.prototype.enable=function(a){this.enabled=a},c.prototype.refresh=function(){var b=this,c=a(this.options.items,this.$element);c.addClass(b.classes.item),c.attr("unselectable","on"),f.off(d.dragend).off(d.drag),c.off(d.dragstart),this.enabled&&(this.$activeItem||c.on(d.dragstart,function(a){b.dragstart(a)}))};var h=b(function(b){var c,d,e=a("."+b.classes.item,b.$element),f=e.length;for(c=0;f>c;c++)if(d=e[c],c!==b.draggingIdx&&b.$dragElement.css("top")>d.offsetTop&&b.$dragElement.css("top")<d.offsetTop+d.offsetHeight&&b.$dragElement.css("left")>d.offsetLeft&&b.$dragElement.css("left")<d.offsetLeft+d.offsetWidth){b.options.onChange(b.draggingIdx,c),b.draggingIdx=c,b.dragged=!0,b.offsetX=offsetX,b.offsetY=offsetY;break}},g);c.prototype.drag=function(a){this.options.onDrag(a),a.isPropagationStopped()||(this.$dragElement.css("top","+="+(a.clientY-this.state.clientY)),this.$dragElement.css("left","+="+(a.clientX-this.state.clientX)),h(this,a),this.state=a)},c.prototype.dragstart=function(b){if(1===b.which){var c=this;this.dragged=!1;var e=a("."+this.classes.item,c.$element),g=a(b.target);if((!this.options.handles||(this.options.handles&&e.find(this.options.handles).addClass(this.classes.handle),g.closest("."+this.classes.handle).length))&&(this.options.onDragstart(b),!b.isPropagationStopped())){b.target=function(){return g.hasClass(c.classes.item)?b.target:g.closest("."+c.classes.item)[0]}(),b.stopPropagation(),c.bodyUnselectable=f.attr("unselectable"),f.attr("unselectable","on");{a(b.target).attr("class")}this.$activeItem=a(b.target).addClass(c.classes.active);var h=this.$activeItem.position();c.draggingIdx=Array.prototype.indexOf.call(e,c.$activeItem[0]),this.$dragElement=a(b.target).clone().css({"z-index":this.options.zindex,width:this.$activeItem[0].offsetWidth,height:this.$activeItem[0].offsetHeight,top:h.top,left:h.left}).removeClass(c.classes.item).addClass(c.classes.clone).appendTo(b.target.parentNode),this.$element.addClass(c.classes.sorting),a(this.options.items,this.$element).off(d.dragstart),f.on(d.drag,function(a){c.drag(a)}).on(d.dragend,function(a){c.dragend(a)}).on(d.selectstart,function(a){return a.preventDefault(),!1}),this.state=b}}},c.prototype.dragend=function(b){var c=this;c.draggingIdx=null,b.isPropagationStopped()||(f.attr("unselectable",c.bodyUnselectable).off(d.drag).off(d.dragend).off(d.selectstart),a(this.options.items,this.$element).on(d.dragstart,function(a){return c.dragstart(a)}),this.dragged?this.options.onDragend(b):a(this.state.originalEvent.target).click(),this.$activeItem.removeClass(this.classes.active),this.$activeItem=null,this.$element.removeClass(this.classes.sorting),this.$dragElement.remove())};var i=function(a,b){var c=a.$root.$$phase;"$apply"===c||"$digest"===c?b&&"function"==typeof b&&b():a.$root.$apply(b)};angular.module("sortable",[]).directive("ngSortable",function(){return{restrict:"A",scope:{ngSortable:"=",ngSortableItems:"@",ngSortableHandles:"@",ngSortableZindex:"@",ngSortableDisable:"=",ngSortableOnChange:"=",ngSortableOnDrag:"=",ngSortableOnDragstart:"=",ngSortableOnDragend:"="},link:function(b,d){function e(a,c){i(b,function(){var b=f.splice(a,1);f.splice(c,0,b[0])})}var f=b.ngSortable;f||(f=[]);var g={items:b.ngSortableItems,handles:b.ngSortableHandles,zindex:b.ngSortableZindex,onChange:e,onDrag:b.ngSortableOnDrag||a.noop,onDragstart:b.ngSortableOnDragstart||a.noop,onDragend:b.ngSortableOnDragend||a.noop};b.ngSortableOnChange&&(g.onChange=function(a,c){e(a,c),b.ngSortableOnChange(a,c)});var h=new c(d,g);b.$watch("ngSortableDisable",function(){h.enable(!b.ngSortableDisable)}),b.$watch("ngSortable.length",function(){h.refresh()})}}})}(jQuery);