!function(a){"use strict";function b(a,b,c){var d;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function c(b,c){this.options=a.extend({items:".sortable",handles:null,zindex:"9000",dragX:!0,dragY:!0,onChange:null,onDragstart:null,onDrag:null,onDragend:null},c);var d=b.scope().$id;this.classes={};for(var f in e)this.classes[f]=e[f]+"-"+d;this.deltaX=0,this.deltaY=0,this.enabled=null,this.state=null,this.$element=a(b),this.$activeItem=null,this.refresh()}var d={drag:"mousemove touchmove",dragstart:"mousedown touchstart",dragend:"mouseup touchend",selectstart:"selectstart"},e={sorting:"sortable-sorting",item:"sortable-item",handle:"sortable-handle",clone:"sortable-clone",active:"sortable-activeitem"},f=a(document.body),g=2;c.prototype.enable=function(a){this.enabled=a},c.prototype.refresh=function(){var b=this,c=a(this.options.items,this.$element);c.addClass(b.classes.item),c.attr("unselectable","on"),f.off(d.dragend).off(d.drag),c.off(d.dragstart),this.enabled&&(this.$activeItem||c.on(d.dragstart,function(a){b.dragstart(a)}))};var h=b(function(b){var c,d=a("."+b.classes.item,b.$element),e=0,f=d.length,g=parseInt(b.$dragElement.css("top"),10),h=parseInt(b.$dragElement.css("left"),10),i=h-b.left,j=g-b.top;if(b.left=h,b.top=g,b.options.dragX){if(!b.options.dragY)if(i>0)e=b.draggingIdx+1;else{if(!(0>i))return;f=b.draggingIdx}}else if(j>0)e=b.draggingIdx+1;else{if(!(0>j))return;f=b.draggingIdx}for(;f>e;e++)if(c=d[e],e!==b.draggingIdx&&g>c.offsetTop&&g<c.offsetTop+c.offsetHeight&&h>c.offsetLeft&&h<c.offsetLeft+c.offsetWidth){b.options.onChange(b.draggingIdx,e),b.draggingIdx=e,b.dragged=!0;break}},g);c.prototype.drag=function(a){this.options.onDrag(a),a.isPropagationStopped()||(this.$dragElement.css("top","+="+(a.clientY-this.state.clientY)),this.$dragElement.css("left","+="+(a.clientX-this.state.clientX)),h(this,a),this.state=a)},c.prototype.dragstart=function(b){if(1===b.which){var c=this;this.dragged=!1;var e=a("."+this.classes.item,c.$element),g=a(b.target);if((!this.options.handles||(this.options.handles&&e.find(this.options.handles).addClass(this.classes.handle),g.closest("."+this.classes.handle).length))&&(this.options.onDragstart(b),!b.isPropagationStopped())){b.target=function(){return g.hasClass(c.classes.item)?b.target:g.closest("."+c.classes.item)[0]}(),b.stopPropagation(),c.bodyUnselectable=f.attr("unselectable"),f.attr("unselectable","on");{a(b.target).attr("class")}this.$activeItem=a(b.target).addClass(c.classes.active);var h=this.$activeItem.position();c.draggingIdx=Array.prototype.indexOf.call(e,c.$activeItem[0]),this.top=h.top,this.left=h.left,this.$dragElement=a(b.target).clone().css({"z-index":this.options.zindex,width:this.$activeItem[0].offsetWidth,height:this.$activeItem[0].offsetHeight,top:h.top,left:h.left}).removeClass(c.classes.item).addClass(c.classes.clone).appendTo(b.target.parentNode),this.$element.addClass(c.classes.sorting),a(this.options.items,this.$element).off(d.dragstart),f.on(d.drag,function(a){c.drag(a)}).on(d.dragend,function(a){c.dragend(a)}).on(d.selectstart,function(a){return a.preventDefault(),!1}),this.state=b}}},c.prototype.dragend=function(b){var c=this;c.draggingIdx=null,b.isPropagationStopped()||(f.attr("unselectable",c.bodyUnselectable).off(d.drag).off(d.dragend).off(d.selectstart),a(this.options.items,this.$element).on(d.dragstart,function(a){return c.dragstart(a)}),this.dragged?this.options.onDragend(b):a(this.state.originalEvent.target).click(),this.$activeItem.removeClass(this.classes.active),this.$activeItem=null,this.$element.removeClass(this.classes.sorting),this.$dragElement.remove())};var i=function(a,b){var c=a.$root.$$phase;"$apply"===c||"$digest"===c?b&&"function"==typeof b&&b():a.$root.$apply(b)};angular.module("sortable",[]).factory("ngSortableOptions",function(){return{}}).directive("ngSortable",["ngSortableOptions",function(b){return{restrict:"A",scope:{ngSortable:"=",ngSortableDirection:"=",ngSortableItems:"@",ngSortableHandles:"@",ngSortableZindex:"@",ngSortableDisable:"=",ngSortableOnChange:"=",ngSortableOnDrag:"=",ngSortableOnDragstart:"=",ngSortableOnDragend:"="},link:function(d,e){function f(a,c){i(d,function(){var e=g.splice(a,1);g.splice(c,0,e[0]),d.ngSortableOnChange?d.ngSortableOnChange(a,c):b.onChange&&b.onChange(a,c)})}var g=d.ngSortable;g||(g=[]);var h=d.ngSortableDirection||b.direction,j={items:d.ngSortableItems||b.items,handles:d.ngSortableHandles||b.handles,zindex:d.ngSortableZindex||b.zindex,onChange:f,onDrag:d.ngSortableOnDrag||b.onDrag||a.noop,onDragstart:d.ngSortableOnDragstart||b.onDragstart||a.noop,onDragend:d.ngSortableOnDragend||b.onDragend||a.noop,dragX:"vertical"!==h,dragY:"horizontal"!==h},k=new c(e,j);d.$watch("ngSortableDisable",function(){k.enable(!d.ngSortableDisable)}),d.$watch("ngSortable.length",function(){k.refresh()})}}}])}(jQuery);